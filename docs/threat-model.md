# acc Threat Model

**Version:** v0.1
**Last Updated:** 2025-01-19

## Overview

`acc` is a secure workload accelerator that enforces verification gates for OCI artifacts. This document defines the security boundaries, in-scope threats, out-of-scope threats, and non-goals for the project.

## Core Security Principle

**Verification gates execution** - If verification fails, workloads cannot run, push, or promote. No bypass flags, no silent degradation.

---

## In-Scope Threats

These threats are within acc's security model and actively mitigated:

### 1. Supply Chain Integrity

**Threat:** Unverified or tampered workloads deployed to production

**Mitigation:**
- SBOM generation and validation required for all builds
- Policy evaluation enforced before run/push/promote
- Cryptographic attestations with canonical hashing
- Verification state persistence prevents stale data
- Image digest validation prevents tag manipulation

### 2. Policy Bypass

**Threat:** Developers circumvent security policies to deploy non-compliant workloads

**Mitigation:**
- No bypass flags in any command
- Verification gates block execution on failure
- Policy mode (`enforce`/`warn`) configurable but explicit
- Waiver expiry enforcement - expired waivers cause verification failure
- Red output means stop (UI signals critical failures)

### 3. Expired Waivers

**Threat:** Temporary policy exceptions remain active beyond approved timeframe

**Mitigation:**
- Strict waiver expiry enforcement
- Expired waiver = verification failure
- Expiry status visible in `inspect` and `policy explain`
- Time-based checks use RFC3339 timestamps
- Invalid expiry dates treated as expired (safe default)

### 4. Configuration Tampering

**Threat:** Malicious modification of acc.yaml or policy files

**Mitigation:**
- Configuration loaded from well-defined paths (documented discovery order)
- Policy pack path validation
- No executable code in configuration files (YAML/Rego only)
- Git-tracked configuration encourages review and audit

### 5. SBOM Manipulation

**Threat:** False or incomplete SBOM allows vulnerable dependencies

**Mitigation:**
- SBOM generated by trusted tool (syft)
- SBOM presence required for verification
- SBOM stored in `.acc/sbom/` with predictable naming
- Policy can validate SBOM content (via Rego)

### 6. Stale Verification State

**Threat:** Old verification results used for new images

**Mitigation:**
- State includes imageRef and timestamp
- `acc attest` validates image digest matches last verified
- `acc push` validates image digest matches last verified
- State files are JSON with schema versioning

---

## Out-of-Scope Threats

These threats are **not** addressed by acc and require other tools:

### 1. Runtime Attacks

**Threat:** Exploitation of running containers (privilege escalation, container escape)

**Why out-of-scope:** acc focuses on supply chain security and workload verification, not runtime protection. Use runtime security tools (Falco, Tracee, etc.) for runtime threat detection.

**Note:** `acc run` provides security defaults (network isolation, dropped capabilities), but these are convenience features, not comprehensive runtime protection.

### 2. Image Registry Compromise

**Threat:** Attacker compromises registry and serves malicious images

**Why out-of-scope:** acc does not implement signature verification or registry authentication. Use Sigstore/Cosign for image signing and verification.

**Future consideration:** May integrate with Sigstore in later versions (currently marked as explicit non-goal).

### 3. Secrets in Images

**Threat:** Hardcoded secrets, API keys, or credentials in container images

**Why out-of-scope:** acc does not scan for secrets. Use dedicated secret scanning tools (truffleHog, gitleaks, etc.).

**Note:** acc policies *could* be written to detect common secret patterns, but this is not a primary use case.

### 4. Code Vulnerabilities

**Threat:** Application code contains security vulnerabilities (SQL injection, XSS, etc.)

**Why out-of-scope:** acc does not perform SAST/DAST scanning. Use dedicated application security testing tools.

### 5. Kubernetes Exploitation

**Threat:** Attacks against Kubernetes API, RBAC, or cluster components

**Why out-of-scope:** acc does not manage Kubernetes clusters or orchestration. Use Kubernetes-native security tools (OPA Gatekeeper, Kyverno, etc.).

### 6. Denial of Service

**Threat:** Resource exhaustion or availability attacks

**Why out-of-scope:** acc is a CLI tool for local and CI use, not a network service. DoS attacks are not applicable.

### 7. Social Engineering

**Threat:** Attackers trick developers into disabling security checks

**Why out-of-scope:** No technical control can fully prevent social engineering. Security training and awareness are required.

**Note:** acc's "no bypass flags" design makes social engineering harder by removing easy escape hatches.

---

## Trust Boundaries

### Trusted

- **User's local filesystem** - acc assumes the filesystem where it runs is trusted
- **Configuration files** (acc.yaml, .acc/waivers.yaml) - assumed to be under version control and reviewed
- **Policy files** (.acc/policy/*.rego) - assumed to be authored by security team
- **OPA/Rego** - trusted policy evaluation engine
- **Container runtime tools** (docker/podman/nerdctl) - trusted for image operations
- **SBOM generation tool** (syft) - trusted for SBOM accuracy

### Untrusted

- **OCI images** - verified before use (SBOM required, policy evaluated)
- **External registries** - images pulled from registries are not trusted until verified
- **User input** - all user-provided image references, tags, and paths are validated
- **Network** - network communication is minimal (registry pulls), not trusted

### Boundary Enforcement

- **Verification gate** - The primary boundary. Only verified workloads cross this boundary to run/push/promote.
- **State files** - `.acc/state/*.json` files persist verification decisions. Tampering with state files does not bypass verification (commands re-verify or validate state).
- **Waivers** - `.acc/waivers.yaml` is trusted but time-limited (expiry enforcement).

---

## Non-Goals

These features are **explicitly excluded** from acc's scope:

1. **Interactive shells** - `acc` will not provide `exec` or shell access to containers
2. **Full Sigstore integration** - v0 does not implement signature verification (may be added later)
3. **Runtime EDR/monitoring** - acc is build-time and deploy-time only
4. **SAST/DAST scanning** - use dedicated tools for code analysis
5. **Secret scanning** - use dedicated tools for secret detection
6. **Kubernetes cluster management** - acc is OCI-focused, not orchestration-focused
7. **Enterprise auth** - v0 has no SSO, MFA, or enterprise identity integration
8. **GUI/UI** - acc is a CLI tool only
9. **Windows support** - Linux/macOS only for v0
10. **Multi-tenancy** - acc is single-user/single-project focused

---

## Assumptions

1. **Filesystem integrity** - The system where acc runs is not compromised
2. **Tool availability** - Required tools (syft, docker/podman) are genuine and not trojan-ed
3. **Config under version control** - Developers use Git or similar to track acc.yaml and policy files
4. **Policy authorship** - Security team writes and reviews Rego policies
5. **Time accuracy** - System clock is accurate for waiver expiry checks

---

## Security Degradation Modes

**acc has NO silent security degradation modes.** All failures are explicit:

- Missing SBOM → verification fails
- Policy violation → verification fails (in enforce mode)
- Expired waiver → verification fails
- Missing verification state → push/attest fails

The only degradation is **warn mode**, which is explicit in configuration and produces visible warnings (yellow output).

---

## Audit and Observability

acc provides audit trails through:

- **State files** - `.acc/state/last_verify.json` records verification decisions
- **Attestations** - `.acc/attestations/` stores cryptographic evidence
- **JSON output** - All commands support `--json` for machine-readable audit logs
- **Exit codes** - Deterministic: 0 = success, 1 = failure, 2 = warnings

---

## Threat Model Maintenance

This threat model should be reviewed and updated when:

- New commands are added
- New verification checks are implemented
- Integration with external systems is added
- Vulnerabilities are discovered
- Security assumptions change

**Next review:** Q2 2025 or upon v1.0 release

---

## Contact

For security concerns or threat model questions:
- Open an issue: https://github.com/cloudcwfranck/acc/issues
- Include `[SECURITY]` in the title for security-related issues
